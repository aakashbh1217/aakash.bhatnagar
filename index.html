<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Friction</title>
  <script>
    (function () {
      "use strict";
      var getSelectorFromTarget = function (target) {
        var className = target.className !== "" ? "." + target.className : "";
        var targetId = target.id !== "" ? "#" + target.id : "";
        return [target.nodeName, className, targetId].join(" ");
      };

      var detectErrorClicks = function (subscribe) {
        var error;
        window.onerror = function (msg) {
          error = msg;
        };

        var listener = function (event) {
          var selector = getSelectorFromTarget(event.target);
          setTimeout(function () {
            if (error) {
              subscribe(selector, error, function () {
                document.removeEventListener("click", listener);
              });
            }
            error = undefined;
          }, 0);
        };

        document.addEventListener("click", listener);
      };

      var detectMouseShake = function(subscribe, _a) {
            var interval = _a.interval,
                threshold = _a.threshold;
            var velocity;
            var direction;
            var directionChangeCount = 0;
            var distance = 0;
            var listeners = function(event) {
                var nextDirection = Math.sign(event.movementX);
                distance += Math.abs(event.movementX) + Math.abs(event.movementY);
                if (nextDirection !== direction) {
                    direction = nextDirection;
                    directionChangeCount++
                }
            };
            var intervalClear = setInterval((function() {
                var nextVelocity = distance / interval;
                if (!velocity) {
                    velocity = nextVelocity;
                    return
                }
                var acceleration = (nextVelocity - velocity) / interval;
                if (directionChangeCount && acceleration > threshold) {
                    subscribe((function() {
                        clearInterval(intervalClear);
                        document.removeEventListener("mousemove", listeners)
                    }))
                }
                distance = 0;
                directionChangeCount = 0;
                velocity = nextVelocity
            }), interval);
            document.addEventListener("mousemove", listeners)
        };

        window.addEventListener('beforeunload', function (event) {
            console.log('Page is about to be refreshed.');
        });

        detectMouseShake(function(unsubscribe) {
            console.log('Mouse shake detected!');
            // unsubscribe(); // Uncomment this line when you want to finish after first trigger
        }, {
            interval: 350, // Number of milliseconds to reset counter
            threshold: 0.005, // Acceleration of mouse movement threshold
        });

      detectErrorClicks(function (target, error, unsubscribe) {
        console.log('Error detected:', error);
        // unsubscribe(); // Uncomment this line when you want to finish after first trigger
      });
    })();
  </script>
</head>
<body>
  <button id="testButton" onclick="myFunction()">Click me to test</button>
  <script>
    function myFunction() {
        throw new Error('Test error');
    }
    </script>
</body>
</html>